<!DOCTYPE html>
<html lang="de" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tradwife Trend Analysis</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    /* Custom checkbox styling */
    .custom-checkbox {
      appearance: none;
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border: 1px solid #ccc;
      border-radius: 3px;
      outline: none;
      cursor: pointer;
      position: relative;
      background-color: white;
    }

    .custom-checkbox:checked {
      background-color: #4f46e5;
      border-color: #4f46e5;
    }

    .custom-checkbox:checked::after {
      content: '';
      position: absolute;
      left: 5px;
      top: 2px;
      width: 5px;
      height: 9px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    /* Dropdown styling */
    .metrics-dropdown-button {
      transition: all 0.2s;
      position: relative;
    }

    .metrics-dropdown-button:hover {
      background-color: #f3f4f6;
    }

    .metrics-dropdown-button::after {
      content: "Klick mich";
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: white;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      white-space: nowrap;
    }

    .metrics-dropdown-button:hover::after {
      opacity: 1;
    }

    .metrics-dropdown-content {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      border-radius: 0.375rem;
      max-height: 300px;
    }

    .metrics-checkbox-container {
      padding: 6px 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .metrics-checkbox-container:hover {
      background-color: #f3f4f6;
    }

    /* Legend item styling with tooltip */
    .metric-legend-item {
      position: relative;
      cursor: pointer;
    }

    .metric-legend-item::after {
      content: "Klick mich";
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: white;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      white-space: nowrap;
      z-index: 10;
    }

    .metric-legend-item:hover::after {
      opacity: 1;
    }

    /* Year selector styling */
    #year-selector {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background-color: white;
    }

    /* Dark mode styles */
    html.dark body {
      background-color: #0f172a;
      color: #e2e8f0;
    }

    html.dark .bg-white {
      background-color: #1e293b;
      color: #e2e8f0;
    }

    html.dark .text-gray-800 {
      color: #e2e8f0;
    }

    html.dark .text-gray-700 {
      color: #cbd5e1;
    }

    html.dark .text-gray-600, 
    html.dark .text-gray-500 {
      color: #94a3b8;
    }

    html.dark .text-indigo-800 {
      color: #a5b4fc;
    }

    html.dark .bg-indigo-100 {
      background-color: #312e81;
      color: #e0e7ff;
    }

    html.dark .text-indigo-600 {
      color: #818cf8;
    }

    html.dark .bg-gray-200,
    html.dark .bg-gray-100,
    html.dark .bg-gray-50 {
      background-color: #334155;
    }

    html.dark .bg-gray-200:hover,
    html.dark .bg-gray-100:hover {
      background-color: #475569;
    }

    html.dark .border-gray-200,
    html.dark .border-gray-100,
    html.dark .border-b {
      border-color: #334155;
    }

    html.dark .shadow-md,
    html.dark .shadow {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
    }

    html.dark .custom-checkbox {
      background-color: #334155;
      border-color: #475569;
    }

    html.dark .metrics-dropdown-button:hover,
    html.dark .metrics-checkbox-container:hover {
      background-color: #475569;
    }

    html.dark .metrics-dropdown-content,
    html.dark #metricsDropdownContent {
      background-color: #1e293b;
      border-color: #475569;
      color: #e2e8f0;
    }

    html.dark #metricsDropdownContent span,
    html.dark .metrics-checkbox-container span {
      color: #e2e8f0;
    }

    html.dark .metrics-dropdown-button::after,
    html.dark .metric-legend-item::after {
      background-color: #475569;
      color: #e2e8f0;
    }

    html.dark select,
    html.dark input,
    html.dark button.border {
      background-color: #1e293b;
      color: #e2e8f0;
      border-color: #475569;
    }

    html.dark #year-selector {
      background-color: #1e293b;
      color: #e2e8f0;
      border-color: #475569;
    }

    /* Dark mode toggle button */
    .dark-mode-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      background-color: #4f46e5;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .dark-mode-toggle:hover {
      transform: scale(1.1);
    }

    html.dark .dark-mode-toggle {
      background-color: #6366f1;
    }
  </style>
</head>
<body class="bg-gray-50 p-6">
  <!-- Dark Mode Toggle Button -->
  <button class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle Dark Mode">
    <i class="fas fa-moon"></i>
  </button>

  <div class="max-w-6xl mx-auto">
    <header class="flex items-end justify-between mb-6 gap-4">
      <div class="min-w-0">
        <h1 class="text-2xl font-bold">Tradwife Trend Analysis</h1>
        <div id="subtitle" class="text-sm text-gray-500 mt-1">Analyzing the Tradwife movement on social media</div>
      </div>

      <div class="flex items-center gap-3 flex-wrap">
        <a href="/" class="px-3 py-2 rounded bg-gray-200 hover:bg-gray-300 text-gray-800">Home</a>

        <label class="font-medium">Jahr:</label>
        <select id="year-selector" class="border rounded p-2 bg-white">
          <option value="all">Alle Jahre</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
          <option value="detailed">Detailliert</option>
        </select>

        <label for="metricsDropdown" class="font-medium">Metrics:</label>
        <div class="relative inline-block">
          <button id="metricsDropdown" type="button" class="border rounded p-2 bg-white flex items-center justify-between min-w-[150px] metrics-dropdown-button">
            <span>Alle Metrics</span>
            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div id="metricsDropdownContent" class="absolute z-10 hidden bg-white border mt-1 metrics-dropdown-content max-h-60 overflow-y-auto min-w-[200px]">
            <div class="p-2 border-b">
              <label class="flex items-center cursor-pointer">
                <input type="checkbox" id="selectAllMetrics" class="mr-2 custom-checkbox" checked>
                <span>Alle ausw√§hlen</span>
              </label>
            </div>
            <div id="metricsCheckboxes" class="p-2">
              <div class="metrics-checkbox-container">
                <label class="flex items-center cursor-pointer w-full">
                  <input type="checkbox" value="videos" class="mr-2 metric-checkbox custom-checkbox" checked>
                  <span>Videos</span>
                </label>
              </div>
              <div class="metrics-checkbox-container">
                <label class="flex items-center cursor-pointer w-full">
                  <input type="checkbox" value="views" class="mr-2 metric-checkbox custom-checkbox" checked>
                  <span>Views</span>
                </label>
              </div>
              <div class="metrics-checkbox-container">
                <label class="flex items-center cursor-pointer w-full">
                  <input type="checkbox" value="likes" class="mr-2 metric-checkbox custom-checkbox" checked>
                  <span>Likes</span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Tabelle -->
    <div class="overflow-x-auto shadow rounded-2xl mb-8 bg-white">
      <table id="tradwifeTable" class="min-w-full border-collapse">
        <thead>
          <tr class="bg-gray-100 text-left" id="tableHead"></tr>
        </thead>
        <tbody></tbody>
        <tfoot id="tableFoot"></tfoot>
      </table>
    </div>

    <!-- Main Chart -->
    <section>
      <!-- Combined Line Chart -->
      <div class="overflow-x-auto shadow rounded-2xl mb-8 bg-white">
        <div id="combinedChartTitle" class="mb-3 text-xl font-bold text-center pt-4" style="display: none;"></div>
        <div class="chart-container" style="position: relative; height: 35vh; min-height: 300px; max-height: 600px; width: 100%; padding: 0 16px 16px;">
          <canvas id="combinedChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Pie Charts -->
    <section class="mt-8 grid gap-8 lg:grid-cols-3">
      <!-- Videos Pie Chart (hidden by default) -->
      <div id="videosPieContainer" class="max-w-xl hidden">
        <div class="mb-2 font-semibold">Distribution of Videos</div>
        <canvas id="videosPieChart"></canvas>
      </div>

      <!-- Views Pie Chart (hidden by default) -->
      <div id="viewsPieContainer" class="max-w-xl hidden">
        <div class="mb-2 font-semibold">Distribution of Views</div>
        <canvas id="viewsPieChart"></canvas>
      </div>

      <!-- Likes Pie Chart (hidden by default) -->
      <div id="likesPieContainer" class="max-w-xl hidden">
        <div class="mb-2 font-semibold">Distribution of Likes</div>
        <canvas id="likesPieChart"></canvas>
      </div>
    </section>

    <!-- Info Cards -->
    <section class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-12">
      <div class="block rounded-2xl bg-white shadow p-6">
        <h2 class="text-xl font-bold text-pink-700 mb-2">üìπ What is Tradwife?</h2>
        <p class="text-gray-600">The "tradwife" (traditional wife) movement promotes traditional gender roles and homemaking.</p>
      </div>

      <div class="block rounded-2xl bg-white shadow p-6">
        <h2 class="text-xl font-bold text-pink-700 mb-2">üìä Data Analysis</h2>
        <p class="text-gray-600">This page analyzes the growth of tradwife content on social media platforms over time.</p>
      </div>

      <div class="block rounded-2xl bg-white shadow p-6">
        <h2 class="text-xl font-bold text-pink-700 mb-2">üîç Methodology</h2>
        <p class="text-gray-600">Data collected from social media platforms tracking videos, views, and engagement metrics.</p>
      </div>
    </section>
  </div>

  <script defer>
    // Custom plugin to add tooltips to legend items
    const legendTooltipPlugin = {
      id: 'legendTooltip',
      afterRender: function(chart) {
        // Use setTimeout to ensure the legend is fully rendered
        setTimeout(() => {
          // Find the legend container
          const legendContainer = chart.canvas.parentNode.querySelector('ul.legend-items') || 
                                 chart.canvas.parentNode.querySelector('.chart-legend') ||
                                 chart.canvas.parentNode.querySelector('ul');

          if (legendContainer) {
            // Get all list items in the legend
            const legendItems = legendContainer.querySelectorAll('li');

            // Add tooltip to legend items for videos, views, and likes
            legendItems.forEach(item => {
              const text = item.textContent.trim();
              if (text.includes('Videos') || text.includes('Views') || text.includes('Likes')) {
                // Add the metric-legend-item class
                item.classList.add('metric-legend-item');

                // Find the color box within the legend item
                const colorBox = item.querySelector('span') || item.querySelector('div');
                if (colorBox) {
                  colorBox.classList.add('metric-legend-item');
                }
              }
            });
          }
        }, 100); // Small delay to ensure DOM is updated
      }
    };

    let dataStore = {
      all: [],
      detailed: [],
      "2020": [],
      "2021": [],
      "2022": [],
      "2023": [],
      "2024": [],
      "2025": []
    };

    let currentView = "all";
    let combinedChart, videosPieChart, viewsPieChart, likesPieChart;
    let sortState = { key: null, dir: 1 };
    let selectedMetrics = ["videos", "views", "likes"];

    // === Time Period Colors ===
    const PERIOD_COLORS = new Map([
      ["2020", "#8B5CF6"],
      ["2021", "#6366F1"],
      ["2022", "#3B82F6"],
      ["2023", "#0EA5E9"],
      ["2024_first_third", "#06B6D4"],
      ["2024_second_third", "#14B8A6"],
      ["2024_third_third", "#10B981"],
      ["2025_first_third", "#22C55E"],
      ["2025_second_third", "#84CC16"]
    ]);

    // === Metrics Colors ===
    const METRICS_COLORS = {
      videos: "#FF6B6B",  // Red
      views: "#4ECDC4",   // Teal
      likes: "#FFD166"    // Yellow
    };

    const prettyPeriod = (period) => {
      if (period.includes("_first_third")) return period.split("_")[0] + " (Jan-Apr)";
      if (period.includes("_second_third")) return period.split("_")[0] + " (May-Aug)";
      if (period.includes("_third_third")) return period.split("_")[0] + " (Sep-Dec)";
      return period;
    };

    const getPeriodColor = (period) => PERIOD_COLORS.get(period) || "#9CA3AF";

    // Format large numbers with commas
    const formatNumber = (num) => num.toLocaleString("de-DE");

    // ---- Load Data ----
    fetch("/answer_seven.json")
      .then(response => {
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        return response.json();
      })
      .then(data => {
        // Process data into different views
        const allData = [];
        const detailedData = [];
        const yearData = {
          "2020": [],
          "2021": [],
          "2022": [],
          "2023": [],
          "2024": [],
          "2025": []
        };

        // Temporary storage for calculating 2024 and 2025 averages
        const year2024Data = {
          periods: 0,
          videos: 0,
          views: 0,
          likes: 0
        };

        const year2025Data = {
          periods: 0,
          videos: 0,
          views: 0,
          likes: 0
        };

        // Process each period in the data
        Object.entries(data).forEach(([period, stats]) => {
          const dataPoint = {
            period: period,
            prettyPeriod: prettyPeriod(period),
            videos: stats.videos,
            views: stats.views,
            likes: stats.likes,
            viewsPerVideo: Math.round(stats.views / stats.videos),
            likesPerVideo: Math.round(stats.likes / stats.videos),
            likesPerView: ((stats.likes / stats.views) * 100).toFixed(2)
          };

          // For detailed view, include all periods
          detailedData.push(dataPoint);

          // Collect data for 2024 and 2025 averages
          if (period.startsWith("2024_")) {
            year2024Data.periods++;
            year2024Data.videos += stats.videos;
            year2024Data.views += stats.views;
            year2024Data.likes += stats.likes;
          } else if (period.startsWith("2025_")) {
            year2025Data.periods++;
            year2025Data.videos += stats.videos;
            year2025Data.views += stats.views;
            year2025Data.likes += stats.likes;
          }

          // For all data view, include full years (except 2024 and 2025 which will be added as averages later)
          if (!period.includes("_") && period !== "2024" && period !== "2025") {
            allData.push(dataPoint);
          }

          // Add to respective year arrays
          if (!period.includes("_")) {
            yearData[period].push(dataPoint);
          } 
          // For periods with year prefix (e.g., 2024_first_third), add to respective year arrays
          else {
            const year = period.split("_")[0];
            if (yearData[year]) {
              yearData[year].push(dataPoint);
            }
          }
        });

        // Add average data points for 2024 and 2025 to allData
        if (year2024Data.periods > 0) {
          allData.push({
            period: "2024",
            prettyPeriod: "2024 (Average)",
            videos: Math.round(year2024Data.videos / year2024Data.periods),
            views: Math.round(year2024Data.views / year2024Data.periods),
            likes: Math.round(year2024Data.likes / year2024Data.periods),
            viewsPerVideo: Math.round((year2024Data.views / year2024Data.periods) / (year2024Data.videos / year2024Data.periods)),
            likesPerVideo: Math.round((year2024Data.likes / year2024Data.periods) / (year2024Data.videos / year2024Data.periods)),
            likesPerView: (((year2024Data.likes / year2024Data.periods) / (year2024Data.views / year2024Data.periods)) * 100).toFixed(2)
          });
        }

        if (year2025Data.periods > 0) {
          allData.push({
            period: "2025",
            prettyPeriod: "2025 (Average)",
            videos: Math.round(year2025Data.videos / year2025Data.periods),
            views: Math.round(year2025Data.views / year2025Data.periods),
            likes: Math.round(year2025Data.likes / year2025Data.periods),
            viewsPerVideo: Math.round((year2025Data.views / year2025Data.periods) / (year2025Data.videos / year2025Data.periods)),
            likesPerVideo: Math.round((year2025Data.likes / year2025Data.periods) / (year2025Data.videos / year2025Data.periods)),
            likesPerView: (((year2025Data.likes / year2025Data.periods) / (year2025Data.views / year2025Data.periods)) * 100).toFixed(2)
          });
        }

        // Sort by period
        allData.sort((a, b) => a.period.localeCompare(b.period));
        detailedData.sort((a, b) => a.period.localeCompare(b.period));
        Object.keys(yearData).forEach(year => {
          yearData[year].sort((a, b) => a.period.localeCompare(b.period));
        });

        dataStore.all = allData;
        dataStore.detailed = detailedData;
        Object.keys(yearData).forEach(year => {
          dataStore[year] = yearData[year];
        });

        refresh();
      })
      .catch(error => console.error("Error loading data:", error));

    // Tabellenkopf mit Sortierung
    function renderHeader(columns) {
      const thead = document.getElementById("tableHead");
      thead.innerHTML = "";
      columns.forEach(col => {
        const th = document.createElement("th");
        th.className = "px-4 py-2 border-b cursor-pointer select-none";
        th.dataset.sort = col.key;
        th.textContent = col.label + " " +
          (sortState.key === col.key ? (sortState.dir === 1 ? "‚ñ≤" : "‚ñº") : "‚ñ≤‚ñº");
        th.addEventListener("click", () => {
          if (sortState.key === col.key) sortState.dir *= -1;
          else { sortState.key = col.key; sortState.dir = 1; }
          refresh();
        });
        thead.appendChild(th);
      });
    }

    function renderTable(data) {
      const columns = [
        { key: "prettyPeriod", label: "Time Period" },
        { key: "videos", label: "Videos" },
        { key: "views", label: "Views" },
        { key: "likes", label: "Likes" },
        { key: "viewsPerVideo", label: "Views/Video" },
        { key: "likesPerVideo", label: "Likes/Video" },
        { key: "likesPerView", label: "Likes/View (%)" }
      ];

      renderHeader(columns);

      const tbody = document.querySelector("#tradwifeTable tbody");
      const tfoot = document.getElementById("tableFoot");
      tbody.innerHTML = "";
      tfoot.innerHTML = "";

      let tableData = data.slice();
      if (sortState.key) {
        tableData.sort((a, b) => {
          const va = a[sortState.key], vb = b[sortState.key];
          return (va < vb ? -1 : va > vb ? 1 : 0) * sortState.dir;
        });
      }

      let totalVideos = 0, totalViews = 0, totalLikes = 0;

      tableData.forEach(row => {
        totalVideos += row.videos;
        totalViews += row.views;
        totalLikes += row.likes;

        const tr = document.createElement("tr");
        tr.className = "hover:bg-gray-50 transition-colors";
        tr.innerHTML = `
          <td class="px-4 py-2 border-b font-medium">
            <span class="inline-block w-3 h-3 rounded-sm align-middle mr-2"
                  style="background:${getPeriodColor(row.period)}"></span>
            ${row.prettyPeriod}
          </td>
          <td class="px-4 py-2 border-b">
            <span class="inline-flex items-center">
              <span class="inline-block w-3 h-3 rounded-sm align-middle mr-2 metric-legend-item"
                    style="background:${METRICS_COLORS.videos}"></span>
              ${formatNumber(row.videos)}
            </span>
          </td>
          <td class="px-4 py-2 border-b">
            <span class="inline-flex items-center">
              <span class="inline-block w-3 h-3 rounded-sm align-middle mr-2 metric-legend-item"
                    style="background:${METRICS_COLORS.views}"></span>
              ${formatNumber(row.views)}
            </span>
          </td>
          <td class="px-4 py-2 border-b">
            <span class="inline-flex items-center">
              <span class="inline-block w-3 h-3 rounded-sm align-middle mr-2 metric-legend-item"
                    style="background:${METRICS_COLORS.likes}"></span>
              ${formatNumber(row.likes)}
            </span>
          </td>
          <td class="px-4 py-2 border-b">${formatNumber(row.viewsPerVideo)}</td>
          <td class="px-4 py-2 border-b">${formatNumber(row.likesPerVideo)}</td>
          <td class="px-4 py-2 border-b">${row.likesPerView}%</td>
        `;
        tbody.appendChild(tr);
      });

      const avgViewsPerVideo = Math.round(totalViews / totalVideos);
      const avgLikesPerVideo = Math.round(totalLikes / totalVideos);
      const avgLikesPerView = ((totalLikes / totalViews) * 100).toFixed(2);

      tfoot.innerHTML = `
        <tr class="bg-gray-50 font-semibold">
          <td class="px-4 py-2 border-t">Total/Average</td>
          <td class="px-4 py-2 border-t">
            <span class="inline-flex items-center">
              <span class="inline-block w-3 h-3 rounded-sm align-middle mr-2 metric-legend-item"
                    style="background:${METRICS_COLORS.videos}"></span>
              ${formatNumber(totalVideos)}
            </span>
          </td>
          <td class="px-4 py-2 border-t">
            <span class="inline-flex items-center">
              <span class="inline-block w-3 h-3 rounded-sm align-middle mr-2 metric-legend-item"
                    style="background:${METRICS_COLORS.views}"></span>
              ${formatNumber(totalViews)}
            </span>
          </td>
          <td class="px-4 py-2 border-t">
            <span class="inline-flex items-center">
              <span class="inline-block w-3 h-3 rounded-sm align-middle mr-2 metric-legend-item"
                    style="background:${METRICS_COLORS.likes}"></span>
              ${formatNumber(totalLikes)}
            </span>
          </td>
          <td class="px-4 py-2 border-t">${formatNumber(avgViewsPerVideo)}</td>
          <td class="px-4 py-2 border-t">${formatNumber(avgLikesPerVideo)}</td>
          <td class="px-4 py-2 border-t">${avgLikesPerView}%</td>
        </tr>
      `;
    }

    function renderCharts(data) {
      // Prepare data for charts
      const labels = data.map(d => d.prettyPeriod);
      const videos = data.map(d => d.videos);
      const views = data.map(d => d.views);
      const likes = data.map(d => d.likes);
      const colors = data.map(d => getPeriodColor(d.period));

      // Combined Chart - Line chart with selected metrics
      const combinedCtx = document.getElementById("combinedChart").getContext("2d");
      if (combinedChart) combinedChart.destroy();

      // Create datasets based on selected metrics
      const datasets = [];

      if (selectedMetrics.includes("videos")) {
        const color = METRICS_COLORS.videos;
        datasets.push({
          label: "Videos",
          data: videos,
          borderColor: color,
          backgroundColor: `${color}33`, // 20% opacity
          borderWidth: 3,
          tension: 0.1,
          yAxisID: 'y-videos'
        });
      }

      if (selectedMetrics.includes("views")) {
        const color = METRICS_COLORS.views;
        datasets.push({
          label: "Views (thousands)",
          data: views.map(v => v / 1000),
          borderColor: color,
          backgroundColor: `${color}33`, // 20% opacity
          borderWidth: 3,
          tension: 0.1,
          yAxisID: 'y-views'
        });
      }

      if (selectedMetrics.includes("likes")) {
        const color = METRICS_COLORS.likes;
        datasets.push({
          label: "Likes (thousands)",
          data: likes.map(l => l / 1000),
          borderColor: color,
          backgroundColor: `${color}33`, // 20% opacity
          borderWidth: 3,
          tension: 0.1,
          yAxisID: 'y-likes'
        });
      }

      combinedChart = new Chart(combinedCtx, {
        type: "line",
        data: {
          labels: labels,
          datasets: datasets
        },
        plugins: [legendTooltipPlugin],
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          stacked: false,
          scales: {
            'y-videos': {
              type: 'linear',
              display: selectedMetrics.includes("videos"),
              position: 'left',
              title: {
                display: true,
                text: "Number of Videos",
                font: {
                  size: 14
                }
              },
              ticks: {
                font: {
                  size: 12
                }
              },
              grid: {
                drawOnChartArea: false,
              }
            },
            'y-views': {
              type: 'linear',
              display: selectedMetrics.includes("views"),
              position: 'right',
              title: {
                display: true,
                text: "Views (thousands)",
                font: {
                  size: 14
                }
              },
              ticks: {
                font: {
                  size: 12
                }
              },
              grid: {
                drawOnChartArea: false,
              }
            },
            'y-likes': {
              type: 'linear',
              display: selectedMetrics.includes("likes"),
              position: 'right',
              title: {
                display: true,
                text: "Likes (thousands)",
                font: {
                  size: 14
                }
              },
              ticks: {
                font: {
                  size: 12
                }
              },
              grid: {
                drawOnChartArea: false,
              }
            }
          },
          plugins: {
            title: {
              display: true,
              text: 'Tradwife Trend Entwicklung',
              font: {
                size: 18
              }
            },
            legend: {
              labels: {
                font: {
                  size: 14
                }
              },
              onHover: function(e, legendItem, legend) {
                // Change cursor to pointer on hover
                if (e.native && e.native.target) {
                  e.native.target.style.cursor = 'pointer';
                }
              },
              onLeave: function(e, legendItem, legend) {
                // Reset cursor when leaving
                if (e.native && e.native.target) {
                  e.native.target.style.cursor = 'default';
                }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.dataset.label || '';
                  const value = context.parsed.y;
                  if (label.includes('Videos')) {
                    return `${label}: ${value}`;
                  } else {
                    return `${label}: ${value}K`;
                  }
                }
              }
            }
          }
        }
      });

      // Show/hide pie charts based on selected metrics

      // Videos Pie Chart
      if (selectedMetrics.includes("videos")) {
        const videosPieCtx = document.getElementById("videosPieChart").getContext("2d");
        if (videosPieChart) videosPieChart.destroy();
        videosPieChart = new Chart(videosPieCtx, {
          type: "pie",
          data: {
            labels: labels,
            datasets: [{
              label: "Videos",
              data: videos,
              backgroundColor: colors,
              borderColor: colors,
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right',
              },
              title: {
                display: true,
                text: 'Distribution of Videos'
              }
            }
          }
        });
        document.getElementById("videosPieContainer").classList.remove("hidden");
      } else {
        document.getElementById("videosPieContainer").classList.add("hidden");
      }

      // Views Pie Chart
      if (selectedMetrics.includes("views")) {
        const viewsPieCtx = document.getElementById("viewsPieChart").getContext("2d");
        if (viewsPieChart) viewsPieChart.destroy();
        viewsPieChart = new Chart(viewsPieCtx, {
          type: "pie",
          data: {
            labels: labels,
            datasets: [{
              label: "Views",
              data: views,
              backgroundColor: colors,
              borderColor: colors,
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right',
              },
              title: {
                display: true,
                text: 'Distribution of Views'
              }
            }
          }
        });
        document.getElementById("viewsPieContainer").classList.remove("hidden");
      } else {
        document.getElementById("viewsPieContainer").classList.add("hidden");
      }

      // Likes Pie Chart
      if (selectedMetrics.includes("likes")) {
        const likesPieCtx = document.getElementById("likesPieChart").getContext("2d");
        if (likesPieChart) likesPieChart.destroy();
        likesPieChart = new Chart(likesPieCtx, {
          type: "pie",
          data: {
            labels: labels,
            datasets: [{
              label: "Likes",
              data: likes,
              backgroundColor: colors,
              borderColor: colors,
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right',
              },
              title: {
                display: true,
                text: 'Distribution of Likes'
              }
            }
          }
        });
        document.getElementById("likesPieContainer").classList.remove("hidden");
      } else {
        document.getElementById("likesPieContainer").classList.add("hidden");
      }
    }

    function refresh() {
      const data = dataStore[currentView] || [];
      const subtitle = document.getElementById("subtitle");

      if (currentView === "all") {
        subtitle.textContent = "Alle Jahre - Tradwife Content Analysis";
      } else if (currentView === "detailed") {
        subtitle.textContent = "Detailed Tradwife Content Analysis";
      } else {
        subtitle.textContent = `Tradwife Content Analysis - ${currentView}`;
      }

      renderTable(data);
      renderCharts(data);

      // Show pie charts section if at least one metric is selected
      const pieChartsSection = document.querySelector('.mt-8.grid.gap-8.lg\\:grid-cols-3');
      if (selectedMetrics.length === 0) {
        pieChartsSection.classList.add('hidden');
      } else {
        pieChartsSection.classList.remove('hidden');
      }
    }

    // Add event listener to year selector
    document.getElementById('year-selector').addEventListener('change', (e) => {
      currentView = e.target.value;
      refresh();
    });

    // Setup metrics dropdown functionality
    const setupMetricsDropdown = () => {
      const dropdownButton = document.getElementById("metricsDropdown");
      const dropdownContent = document.getElementById("metricsDropdownContent");
      const selectAllCheckbox = document.getElementById("selectAllMetrics");
      const metricCheckboxes = document.querySelectorAll(".metric-checkbox");

      // Toggle dropdown when button is clicked
      dropdownButton.addEventListener("click", () => {
        dropdownContent.classList.toggle("hidden");
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (!dropdownButton.contains(e.target) && !dropdownContent.contains(e.target)) {
          dropdownContent.classList.add("hidden");
        }
      });

      // Select All checkbox functionality
      selectAllCheckbox.addEventListener("change", () => {
        const isChecked = selectAllCheckbox.checked;
        metricCheckboxes.forEach(checkbox => {
          checkbox.checked = isChecked;
        });
        updateSelectedMetrics();
        updateDropdownButtonText();
      });

      // Add event listener to each metric checkbox
      metricCheckboxes.forEach(checkbox => {
        checkbox.addEventListener("change", () => {
          updateSelectedMetrics();
          updateDropdownButtonText();
        });
      });

      // Function to update selectedMetrics array based on checked checkboxes
      function updateSelectedMetrics() {
        selectedMetrics = [];
        document.querySelectorAll(".metric-checkbox:checked").forEach(checkbox => {
          selectedMetrics.push(checkbox.value);
        });

        // Update "Select All" checkbox state
        const allCheckboxes = document.querySelectorAll(".metric-checkbox");
        const checkedCheckboxes = document.querySelectorAll(".metric-checkbox:checked");
        selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length;

        refresh();
      }

      // Function to update dropdown button text
      function updateDropdownButtonText() {
        const allCheckboxes = document.querySelectorAll(".metric-checkbox");
        const checkedCheckboxes = document.querySelectorAll(".metric-checkbox:checked");

        if (checkedCheckboxes.length === 0) {
          dropdownButton.querySelector("span").textContent = "Keine Metrics";
        } else if (checkedCheckboxes.length === allCheckboxes.length) {
          dropdownButton.querySelector("span").textContent = "Alle Metrics";
        } else if (checkedCheckboxes.length === 1) {
          dropdownButton.querySelector("span").textContent = checkedCheckboxes[0].value.charAt(0).toUpperCase() + checkedCheckboxes[0].value.slice(1);
        } else {
          dropdownButton.querySelector("span").textContent = `${checkedCheckboxes.length} Metrics`;
        }
      }
    };

    // Initialize metrics dropdown
    setupMetricsDropdown();
  </script>

  <!-- Dark Mode JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const darkModeToggle = document.getElementById('darkModeToggle');
      const htmlElement = document.documentElement;
      const moonIcon = '<i class="fas fa-moon"></i>';
      const sunIcon = '<i class="fas fa-sun"></i>';

      // Check for saved theme preference or use system preference
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

      // Apply the saved theme or system preference
      if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        htmlElement.classList.add('dark');
        darkModeToggle.innerHTML = sunIcon;
      } else {
        htmlElement.classList.remove('dark');
        darkModeToggle.innerHTML = moonIcon;
      }

      // Toggle dark mode on button click
      darkModeToggle.addEventListener('click', function() {
        if (htmlElement.classList.contains('dark')) {
          htmlElement.classList.remove('dark');
          localStorage.setItem('theme', 'light');
          darkModeToggle.innerHTML = moonIcon;
        } else {
          htmlElement.classList.add('dark');
          localStorage.setItem('theme', 'dark');
          darkModeToggle.innerHTML = sunIcon;
        }
      });
    });
  </script>

  <!-- Footer -->
  <footer class="mt-16 w-full max-w-5xl mx-auto">
    <div class="border-t border-gray-200 pt-8 pb-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <h3 class="text-lg font-semibold text-indigo-800">DataDivas</h3>
          <p class="text-gray-600">Datenanalyse zum Einfluss sozialer Medien auf die Politik</p>
        </div>
        <div class="flex space-x-4">
          <a href="/impressum" class="text-indigo-600 hover:text-indigo-800 transition">Impressum</a>
          <a href="/datenschutz" class="text-indigo-600 hover:text-indigo-800 transition">Datenschutz</a>
          <a href="/kontakt" class="text-indigo-600 hover:text-indigo-800 transition">Kontakt</a>
        </div>
      </div>
      <div class="mt-6 text-center text-gray-500 text-sm">
        ¬© 2023 DataDivas. Alle Rechte vorbehalten.
      </div>
    </div>
  </footer>
  </div> <!-- Close the main content div -->
</body>
</html>
