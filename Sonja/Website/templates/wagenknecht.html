<!DOCTYPE html>
<html lang="de" class="light">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Sahra Wagenknecht – Comment Analysis</title>
    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <!-- WordCloud library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js" defer></script>
    <style>
        .dark .card {
            background-color: #111827;
        }

        .dark .text-muted {
            color: #9CA3AF;
        }

        .dark-mode-toggle {
            position: fixed;
            right: 16px;
            top: 16px;
            z-index: 1000;
            background: #e5e7eb;
            color: #111827;
            border-radius: 9999px;
            padding: 10px 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .dark .dark-mode-toggle {
            background: #111827;
            color: #e5e7eb;
        }

        /* Constrain chart height to prevent infinite growth */
        .chart-container {
            position: relative;
            height: 35vh;
            min-height: 300px;
            max-height: 600px;
            width: 100%;
            padding: 0 0 8px;
        }

        .chart-container canvas {
            display: block;
            width: 100% !important;
            height: 100% !important;
        }

        /* Large combined wordcloud (analog zu FFF) */
        #wordcloud {
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            width: min(100%, 900px);
        }

        #wordcloud canvas {
            width: 100% !important;
            height: 100% !important;
            display: block;
        }
    </style>
    <link rel="icon" type="image/png" href="{{ url_for('favicon') }}">
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 to-blue-100 text-gray-900">
{% include 'partials/dark_mode_toggle.html' %}

{% set page_title = 'Sahra Wagenknecht – Comment Analysis' %}
{% include 'partials/page_header.html' %}

<div class="max-w-7xl mx-auto">

    <section class="card shadow rounded-2xl bg-white p-4 mb-6">
        <h2 class="text-2xl font-semibold mb-3">Introduction</h2>
        <p class="mb-3">Sahra Wagenknecht is a well-known German politician and former leading member of Die Linke (The Left). In 2023, she founded her own party, the Bündnis Sahra Wagenknecht (BSW), trying to combine left-wing social policies with more conservative positions on cultural issues and migration issues. Because of her strong media presence and controversial positions, Wagenknecht attracts significant attention on social media platforms.</p>
        <p class="mb-3">Studying how her perception changed before and after the founding of the BSW is relevant for understanding how political figures shape online debates and how new parties can influence political discourse in Germany. This helps to highlight the role of social media in shaping public opinion during times of political transition.</p>
        <h3 class="text-xl font-semibold mt-4 mb-2">What Data did we collect?</h3>
        <p class="mb-3">We collected the top twenty most relevant comments from each of the top 100 most liked videos on Sarah Wagenknechts YouTube Channel both before and after the founding of the BSW.
In total we collected ~2000 comments from each period from which we selected the 500 most liked comments to end up with a total of 1000 comments to analyse.</p>
        <h3 class="text-xl font-semibold mt-4 mb-2">Wordcloud:</h3>
        <p class="mb-3">We generated a WordCloud using keybert based on keywords extracted from the comments.</p>
    </section>

<p class="mt-3 max-w-3xl mx-auto text-gray-700 text-center">Most common words in YouTube comments – Before/After</p>

<!-- Kombinierte Wordcloud (analog zu FridaysForFuture) -->
<section class="card shadow rounded-2xl bg-white p-4 mb-6">
    <h2 class="text-xl font-bold mb-3 text-center">Wordcloud by keyword occurrence</h2>
    <p class="mt-3 max-w-3xl mx-auto text-gray-700 mb-2 text-center">Combined from before/after comments on Sahra
        Wagenknecht.</p>
    <div id="wordcloud" style="height: 820px;"></div>
</section>


<!-- Bar Charts -->
<section class="grid gap-6 lg:grid-cols-2 mt-6">
    <div class="card overflow-x-auto shadow rounded-2xl bg-white p-4">
        <div class="mb-2 font-semibold">Top words – Before</div>
        <div class="chart-container">
            <canvas id="chartBefore"></canvas>
        </div>
    </div>
    <div class="card overflow-x-auto shadow rounded-2xl bg-white p-4">
        <div class="mb-2 font-semibold">Top words – After</div>
        <div class="chart-container">
            <canvas id="chartAfter"></canvas>
        </div>
    </div>
</section>


<!-- Combined Bar Chart with Words on X-Axis -->
<section class="mt-8">
    <div class="card overflow-x-auto shadow rounded-2xl bg-white p-4">
        <div class="mb-2 font-semibold">Comparison by words (X-axis: words)</div>
        <div class="chart-container">
            <canvas id="wordAxisCompare"></canvas>
        </div>
    </div>
</section>

<!-- Comparison Table -->
<section class="overflow-x-auto shadow rounded-2xl mt-8 bg-white">
    <table class="min-w-full border-collapse" id="compareTable">
        <thead>
        <tr class="bg-gray-100 text-left">
            <th class="p-3">Rank</th>
            <th class="p-3">Word (Before)</th>
            <th class="p-3">Count (Before)</th>
            <th class="p-3">Word (After)</th>
            <th class="p-3">Count (After)</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<section class="mt-8 mb-6 card shadow rounded-2xl bg-white p-4">
    <h2 class="text-2xl font-semibold mb-3">Conclusion</h2>
    <p class="mb-3">The comparison of comments before and after the founding of the BSW shows that the overall perception of Sahra Wagenknecht on social media has remained largely stable. In both periods, the most frequent keywords are strongly centered on her as a person with entries like “Wagenknecht” an “Frau Wagenknecht” as one of the  most mentioned key words. Words like “frieden” and “deutschland” also appear as some of the to comments both before and after the founding of the BSW.</p>
    <p class="mb-3">Although the relative frequencies of some words shifted—such as “krieg” being more present before than after, the dominant narrative remained consistent: Wagenknecht is discussed as a central political figure associated with peace, democracy, and strong rhetoric. Positive evaluative terms like “danke”, “hochachtung”, and “großartig” appear regularly in both timeframes.</p>
</section>
</div>

<script>
    // --- Dark mode ---
    (function initTheme() {
        const savedTheme = localStorage.getItem("theme") || "light";
        document.documentElement.classList.toggle("dark", savedTheme === "dark");
        document.documentElement.classList.toggle("light", savedTheme !== "dark");
        const btn = document.getElementById("darkModeToggle");
        const moon = '<i class="fas fa-moon"></i>';
        const sun = '<i class="fas fa-sun"></i>';
        btn.innerHTML = savedTheme === "dark" ? sun : moon;
        btn.addEventListener("click", () => {
            const isDark = document.documentElement.classList.toggle("dark");
            document.documentElement.classList.toggle("light", !isDark);
            localStorage.setItem("theme", isDark ? "dark" : "light");
            btn.innerHTML = isDark ? sun : moon;
            // Re-render combined wordcloud to adapt background/colors
            if (typeof safeRenderCombined === 'function') {
                setTimeout(() => safeRenderCombined(), 50);
            }
        });
    })();

    window.addEventListener('load', function () {
        // Utility to get top N terms
        function topN(data, n = 20) {
            // data is array of {words, numbers}
            const sorted = [...data].sort((a, b) => b.numbers - a.numbers);
            return sorted.slice(0, n);
        }

        function getBg() {
            return document.documentElement.classList.contains('dark') ? '#111827' : '#ffffff';
        }

        function pickWordColor() {
            const isDark = document.documentElement.classList.contains('dark');
            const lightPalette = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#17becf', '#bcbd22', '#ff6384', '#36a2eb', '#4bc0c0', '#f59e0b', '#ef4444', '#10b981', '#8b5cf6'];
            const darkPalette = ['#93c5fd', '#34d399', '#fbbf24', '#f87171', '#a78bfa', '#22d3ee', '#a3e635', '#fb923c', '#fb7185', '#2dd4bf', '#fde68a', '#60a5fa'];
            const pal = isDark ? darkPalette : lightPalette;
            return pal[Math.floor(Math.random() * pal.length)];
        }

        // Load both datasets
        Promise.all([
            fetch('/wagenknecht_words_a.json').then(r => r.json()),
            fetch('/wagenknecht_words_b.json').then(r => r.json())
        ]).then(([beforeData, afterData]) => {
            const topBefore = topN(beforeData, 20);
            const topAfter = topN(afterData, 20);

            // Prepare data
            const labelsBefore = topBefore.map(d => d.words);
            const valuesBefore = topBefore.map(d => d.numbers);
            const labelsAfter = topAfter.map(d => d.words);
            const valuesAfter = topAfter.map(d => d.numbers);


            // Build combined list for the big wordcloud (sum A+B by word)
            const combinedMap = new Map();
            [...beforeData, ...afterData].forEach(d => {
                const w = String(d.words || '').toLowerCase();
                const n = Number(d.numbers) || 0;
                if (!w) return;
                combinedMap.set(w, (combinedMap.get(w) || 0) + n);
            });
            const combinedList = Array.from(combinedMap.entries())
                .sort((a, b) => b[1] - a[1])
                .slice(0, 200);


            const wcCombinedEl = document.getElementById('wordcloud');

            // Render combined big wordcloud analogous to FFF
            function renderCombined() {
                if (!wcCombinedEl) return;
                wcCombinedEl.innerHTML = '';
                WordCloud(wcCombinedEl, {
                    list: combinedList,
                    gridSize: 10,
                    weightFactor: (count) => {
                        const w = wcCombinedEl.clientWidth || 800;
                        const base = Math.sqrt(count);
                        // Scale with container size; keep large words reasonable
                        return Math.max(20, base * (w / 120));
                    },
                    color: pickWordColor,
                    backgroundColor: getBg(),
                    rotateRatio: 0,
                    shape: 'circle',
                    ellipticity: 0.9
                });
            }

            function safeRenderCombined(attempt = 0) {
                const ready = wcCombinedEl && wcCombinedEl.clientWidth > 50 && wcCombinedEl.clientHeight > 50;
                if (!ready && attempt < 20) {
                    return setTimeout(() => safeRenderCombined(attempt + 1), 120);
                }
                renderCombined();
            }

            safeRenderCombined();


            // Render bar charts
            const ctxB = document.getElementById('chartBefore').getContext('2d');
            const ctxA = document.getElementById('chartAfter').getContext('2d');

            const commonOpts = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {legend: {display: false}},
                scales: {
                    x: {
                        ticks: {autoSkip: false, maxRotation: 60, minRotation: 0},
                        title: { display: true, text: 'Words' }
                    },
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Count' }
                    }
                }
            };

            new Chart(ctxB, {
                type: 'bar',
                data: {
                    labels: labelsBefore,
                    datasets: [{label: 'Amount', data: valuesBefore, backgroundColor: '#60A5FA'}]
                },
                options: commonOpts
            });

            new Chart(ctxA, {
                type: 'bar',
                data: {
                    labels: labelsAfter,
                    datasets: [{label: 'Amount', data: valuesAfter, backgroundColor: '#34D399'}]
                },
                options: commonOpts
            });


            // Combined bar chart with words on X-axis
            const wordSet = new Map();
            topBefore.forEach(d => wordSet.set(d.words, (wordSet.get(d.words) || 0) + d.numbers));
            topAfter.forEach(d => wordSet.set(d.words, (wordSet.get(d.words) || 0) + d.numbers));
            // Sort words by combined frequency desc and take top N (e.g., 20)
            const combinedWords = Array.from(wordSet.entries()).sort((a, b) => b[1] - a[1]).slice(0, 20).map(([w]) => w);
            const beforeByWord = combinedWords.map(w => (beforeData.find(d => d.words === w)?.numbers) || 0);
            const afterByWord = combinedWords.map(w => (afterData.find(d => d.words === w)?.numbers) || 0);
            const ctxWordAxis = document.getElementById('wordAxisCompare').getContext('2d');
            new Chart(ctxWordAxis, {
                type: 'bar',
                data: {
                    labels: combinedWords,
                    datasets: [
                        {label: 'Before', data: beforeByWord, backgroundColor: 'rgba(59,130,246,0.7)'},
                        {label: 'After', data: afterByWord, backgroundColor: 'rgba(16,185,129,0.7)'}
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {legend: {display: true}},
                    scales: {
                        x: {
                            ticks: {autoSkip: false, maxRotation: 60, minRotation: 0},
                            title: {display: true, text: 'Words'}
                        },
                        y: {beginAtZero: true, title: {display: true, text: 'Count'}}
                    }
                }
            });

            // Render comparison table
            const tbody = document.querySelector('#compareTable tbody');
            const maxRows = Math.max(topBefore.length, topAfter.length);
            for (let i = 0; i < maxRows; i++) {
                const b = topBefore[i];
                const a = topAfter[i];
                const tr = document.createElement('tr');
                tr.className = i % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                tr.innerHTML = `
          <td class="p-3">${i + 1}</td>
          <td class="p-3">${b ? b.words : ''}</td>
          <td class="p-3">${b ? b.numbers : ''}</td>
          <td class="p-3">${a ? a.words : ''}</td>
          <td class="p-3">${a ? a.numbers : ''}</td>
        `;
                tbody.appendChild(tr);
            }

            // Re-render combined wordcloud on resize (debounced)
            let resizeTimer = null;
            window.addEventListener('resize', () => {
                if (resizeTimer) clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    safeRenderCombined();
                }, 200);
            });
        }).catch(err => {
            console.error('Fehler beim Laden der Wagenknecht-Daten:', err);
        });
    });
</script>
{% include 'partials/footer.html' %}
</body>
</html>
